---
name: WIF Setup Helper

on:
  workflow_dispatch: {}

permissions:
  id-token: write
  contents: read

jobs:
  wif-debug:
    name: Display WIF Configuration Values
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Debug OIDC token
        run: |
          TOKEN=$(curl -s "${ACTIONS_ID_TOKEN_REQUEST_URL}&audience=google" \
            -H "Authorization: Bearer $ACTIONS_ID_TOKEN_REQUEST_TOKEN")
          echo "$TOKEN" | jq -r '.'

      - name: Display WIF Configuration Values
        run: |
          echo "=== Google Cloud Workload Identity Federation Setup Values ==="
          echo ""
          echo "üìã Basic Information:"
          echo "  Repository: ${{ github.repository }}"
          echo "  Repository Owner: ${{ github.repository_owner }}"
          echo "  Repository Name: ${{ github.event.repository.name }}"
          echo ""
          echo "üîê Identity Information:"
          echo "  Workflow Ref: ${{ github.ref }}"
          echo "  Branch: ${{ github.ref_name }}"
          echo "  Actor: ${{ github.actor }}"
          echo "  Run ID: ${{ github.run_id }}"
          echo "  Run Number: ${{ github.run_number }}"
          echo ""
          echo "üåê WIF Configuration:"
          echo "  Issuer URL: https://token.actions.githubusercontent.com"
          echo "  Subject: repo:${{ github.repository }}:ref:${{ github.ref }}"
          echo ""
          echo "üìù Suggested attribute mappings for WIF pool provider:"
          echo "  google.subject=assertion.sub"
          echo "  attribute.actor=assertion.actor"
          echo "  attribute.repository=assertion.repository"
          echo "  attribute.repository_owner=assertion.repository_owner"
          echo ""
          echo "üéØ Example attribute condition (restrict to this repo):"
          echo "  assertion.repository=='${{ github.repository }}'"
          echo ""
          echo "üìö Documentation:"
          DOC1="https://cloud.google.com/iam/docs"
          DOC2="/workload-identity-federation-with-deployment-pipelines"
          echo "  ${DOC1}${DOC2}"
          DOC3="https://docs.github.com/en/actions/deployment"
          DOC4="/security-hardening-your-deployments"
          DOC5="/about-security-hardening-with-openid-connect"
          echo "  ${DOC3}${DOC4}${DOC5}"
